<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Favoritos - E2E SHOP</title>
  <link rel="icon" type="image/png" href="assets/images/logo/favicon/favicon.png">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/product-images.css?v=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74',
              400: '#fb923c', 500: '#f97316', 600: '#ea580c', 700: '#c2410c', 800: '#9a3412', 900: '#7c2d12'
            }
          },
          fontFamily: { 'sans': ['Inter','system-ui','sans-serif'] }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-white text-gray-900">
  <!-- Header padr√£o da Home -->
  <header class="bg-white shadow-xl border-b border-gray-100 sticky top-0 z-50 backdrop-blur-md bg-white/95">
    <!-- Top Bar -->
    <div class="bg-gradient-to-r from-primary-600 via-primary-700 to-primary-800 text-white py-3">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-4">
            <span class="text-sm font-medium flex items-center space-x-2 animate-pulse-slow">
              <i class="fas fa-truck text-primary-200"></i>
              <span>Frete gr√°tis para pedidos acima de R$ 99</span>
            </span>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a href="tel:+5511999999999" class="text-sm hover:text-primary-200 transition-all duration-300 flex items-center space-x-2 hover:scale-105"><i class="fas fa-phone"></i><span>(11) 99999-9999</span></a>
            <a href="mailto:contato@e2eshop.com" class="text-sm hover:text-primary-200 transition-all duration-300 flex items-center space-x-2 hover:scale-105"><i class="fas fa-envelope"></i><span>contato@e2eshop.com</span></a>
          </div>
        </div>
      </div>
    </div>
    <!-- Main Header -->
    <div class="bg-white py-4 border-b border-gray-100">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between">
          <!-- Logo -->
          <div class="flex items-center space-x-3">
            <a href="index.html" class="flex items-center space-x-3 group">
              <img src="assets/images/logo/header/logo-dark.png" alt="E2E Shop Logo" class="header-logo h-10 w-auto transition-all duration-300 group-hover:scale-105" data-context="header">
            </a>
          </div>
          <!-- Busca (oculta no mobile) -->
          <div class="hidden md:block flex-1 max-w-2xl mx-8">
            <div class="relative">
              <div class="flex rounded-xl border border-gray-300 hover:border-primary-400 focus-within:border-primary-500 transition-all duration-300 shadow-sm hover:shadow-md">
                <select class="bg-gray-50 text-gray-700 px-3 py-2.5 rounded-l-xl border-0 focus:ring-0 focus:outline-none text-sm font-medium min-w-[140px]">
                  <option value="">Todas as categorias</option>
                  <option value="smartphones">Smartphones</option>
                  <option value="notebooks">Notebooks</option>
                  <option value="tablets">Tablets</option>
                  <option value="acessorios">Acess√≥rios</option>
                </select>
                <div class="flex-1 relative">
                  <input type="text" class="search-input w-full px-4 py-2.5 border-0 focus:ring-0 focus:outline-none text-gray-700 placeholder-gray-400" placeholder="Buscar produtos, marcas e mais...">
                  <button class="search-btn absolute right-2 top-1/2 transform -translate-y-1/2 bg-primary-500 hover:bg-primary-600 text-white p-1.5 rounded-lg transition-all duration-300 hover:scale-105"><i class="fas fa-search text-sm"></i></button>
                </div>
              </div>
            </div>
          </div>
          <!-- A√ß√µes Header -->
          <div class="flex items-center space-x-4">
            <!-- Favoritos -->
            <a href="favorites.html" class="relative p-3 text-gray-600 hover:text-primary-600 transition-all duration-300 hover:scale-110" title="Favoritos">
              <i class="fas fa-heart text-xl"></i>
              <span class="favorites-count-badge absolute -top-1 -right-1 bg-primary-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center" style="display:none">0</span>
            </a>
            <!-- Carrinho -->
            <a href="cart.html" class="relative p-3 text-gray-600 hover:text-primary-600 transition-all duration-300 hover:scale-110 group">
              <i class="fas fa-shopping-cart text-xl"></i>
              <span class="absolute -top-1 -right-1 bg-primary-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center cart-count">0</span>
              <div class="absolute top-full right-0 mt-2 w-64 bg-white border border-gray-200 rounded-xl shadow-lg p-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300">
                <div class="text-sm"><div class="font-medium text-gray-900">Carrinho</div><div class="text-gray-500 cart-total">R$ 0,00</div></div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
    <!-- Navega√ß√£o (oculta no mobile) -->
    <nav class="hidden md:block bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between py-2">
          <div class="flex items-center space-x-8">
            <div class="relative categories-container">
              <button class="categories-btn flex items-center space-x-2 px-3 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-all duration-300 hover:scale-105 font-medium text-sm"><i class="fas fa-bars"></i><span>Categorias</span></button>
              <div class="categories-sidebar"></div>
              <div class="mega-menu"></div>
            </div>
            <div class="flex items-center space-x-6">
              <a href="index.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg font-medium transition-all duration-300 text-sm"><i class="fas fa-home text-sm"></i><span>In√≠cio</span></a>
              <a href="products.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg font-medium transition-all duration-300 text-sm"><i class="fas fa-th-large text-sm"></i><span>Produtos</span></a>
              <a href="products.html?category=best-sellers" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg font-medium transition-all duration-300 text-sm"><i class="fas fa-fire text-sm"></i><span>Mais Vendidos</span></a>
              <a href="products.html?category=offers" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg font-medium transition-all duration-300 text-sm"><i class="fas fa-percentage text-sm"></i><span>Ofertas</span></a>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main moderno -->
  <main class="relative">
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <div class="h-72 bg-gradient-to-br from-gray-50 via-white to-blue-50"></div>
    </div>
    <section class="relative container mx-auto px-4 py-10">
      <div class="mb-8 text-center">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-pink-500 to-rose-600 rounded-full mb-6 shadow-2xl"><i class="fas fa-heart text-white text-3xl"></i></div>
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2"><span class="bg-gradient-to-r from-pink-600 via-red-600 to-orange-500 bg-clip-text text-transparent">Seus Favoritos</span></h1>
        <p class="text-gray-600">Produtos que voc√™ marcou com ‚ù§</p>
      </div>

      <div id="favorites-empty" class="hidden text-center py-16">
        <div class="w-20 h-20 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center mx-auto mb-4"><i class="fas fa-heart text-2xl"></i></div>
        <h2 class="text-xl font-semibold mb-2">Nenhum favorito ainda</h2>
        <p class="text-gray-600 mb-6">Explore nossos produtos e adicione aos favoritos.</p>
        <a href="products.html" class="inline-flex items-center px-5 py-3 rounded-xl bg-primary-500 text-white hover:bg-primary-600"><i class="fas fa-th-large mr-2"></i>Explorar produtos</a>
      </div>

      <div id="favorites-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </section>
  </main>

  <!-- Footer padr√£o da Home -->
  <footer class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-12">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <div class="space-y-4">
          <div class="flex items-center space-x-3">
            <img src="assets/images/logo/footer/logo-white.png" alt="E2E Shop Logo" class="footer-logo h-8 w-auto" data-context="footer">
          </div>
          <p class="text-gray-400 text-sm leading-relaxed">Sua loja online moderna e tecnol√≥gica com os melhores produtos de qualidade.</p>
        </div>
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white">Produtos</h3>
          <ul class="space-y-2">
            <li><a href="products.html?category=smartphones" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Smartphones</a></li>
            <li><a href="products.html?category=notebooks" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Notebooks</a></li>
            <li><a href="products.html?category=tablets" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Tablets</a></li>
            <li><a href="products.html?category=acessorios" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Acess√≥rios</a></li>
          </ul>
        </div>
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white">Suporte</h3>
          <ul class="space-y-2">
            <li><a href="contact.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Contato</a></li>
            <li><a href="faq.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Perguntas Frequentes</a></li>
            <li><a href="shipping.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Frete e Entrega</a></li>
            <li><a href="returns.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Devolu√ß√µes</a></li>
          </ul>
        </div>
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white">Conta</h3>
          <ul class="space-y-2">
            <li><a href="login.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Entrar</a></li>
            <li><a href="register.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Cadastrar</a></li>
            <li><a href="profile.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Meu Perfil</a></li>
            <li><a href="orders.html" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Meus Pedidos</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="border-t border-gray-800">
      <div class="container mx-auto px-4 py-6">
        <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
          <div class="text-center md:text-left">
            <p class="text-gray-400 text-sm">&copy; 2024 E2E SHOP. Todos os direitos reservados.</p>
          </div>
          <div class="flex items-center space-x-4">
            <span class="text-gray-500 text-xs">Formas de Pagamento:</span>
            <div class="flex space-x-2"><i class="fab fa-cc-visa text-gray-400 text-lg"></i><i class="fab fa-cc-mastercard text-gray-400 text-lg"></i><i class="fas fa-credit-card text-gray-400 text-lg"></i><i class="fas fa-mobile-alt text-gray-400 text-lg"></i></div>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts da API e Sistema E-commerce -->
  <script src="assets/js/products-api.js"></script>
  <script src="assets/js/products-local.js"></script>
  <script src="assets/js/ecommerce-system.js"></script>
  <script src="assets/js/api-network-call.js"></script>
  <script src="assets/js/product-images.js"></script>
  <script src="assets/js/cart-functions.js"></script>
  <script src="assets/js/categories.js?v=4.0"></script>
  <script>
    // Atualizar badge e nome do usu√°rio no header
    document.addEventListener('DOMContentLoaded', function(){
      function getFavKey(){ let u=null; try{u=JSON.parse(localStorage.getItem('e2e_current_user')||'null');}catch{} return (u&&u.id)?('e2e_favorites_'+u.id):'e2e_favorites_guest'; }
      function updateFavBadge(){ const badge=document.querySelector('.favorites-count-badge'); if(!badge) return; let favs=[]; try{ favs=JSON.parse(localStorage.getItem(getFavKey())||'[]'); }catch{} badge.textContent=(favs||[]).length; badge.style.display=(favs&&favs.length>0)?'flex':'none'; }
      function updateUserName(){ const el=document.getElementById('user-name'); if(!el) return; let u=null; try{u=JSON.parse(localStorage.getItem('e2e_current_user')||'null');}catch{} if(u&&u.firstName){ el.textContent = `${u.firstName} ${u.lastName||''}`.trim(); } else { el.textContent = 'Visitante'; } }
      updateFavBadge(); window.addEventListener('favoritesUpdated', updateFavBadge);
      updateUserName();
    });

    // L√≥gica de favoritos (guest + merge em login)
    function getCurrentUser(){ try{ return JSON.parse(localStorage.getItem('e2e_current_user')||'null'); }catch{ return null; } }
    function readFavoritesIds(){ const u=getCurrentUser(); let guest=[]; try{ guest=JSON.parse(localStorage.getItem('e2e_favorites_guest')||'[]'); }catch{} if(u&&u.id){ let userFav=[]; try{ userFav=JSON.parse(localStorage.getItem('e2e_favorites_'+u.id)||'[]'); }catch{} const merged=Array.from(new Set([...(userFav||[]), ...(guest||[])])); localStorage.setItem('e2e_favorites_'+u.id, JSON.stringify(merged)); localStorage.removeItem('e2e_favorites_guest'); return merged; } return guest; }
    function resolveProductById(id){ const list=(window.localProducts||[]); const p=list.find(p=>String(p.id)===String(id)); if(!p) return null; return { id:p.id, name:p.name||p.title, brand:p.brand, description:p.description, price:p.price, originalPrice:p.originalPrice, discount:p.discount, stock:p.stock, rating:p.rating||4.5, image:p.image.startsWith('assets/')?p.image:'assets/images/products/'+p.image, category:p.category }; }
    function renderCard(product){ return `
      <div class="product-card group bg-white rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 overflow-hidden border border-gray-100 transform hover:-translate-y-3 hover:scale-105 relative flex flex-col h-full">
        <div class="relative overflow-hidden h-64 cursor-pointer" onclick="openProductDetail(${product.id})">
          <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
          <div class="absolute top-4 left-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg"><i class="fas fa-tag mr-1"></i>${product.category||'Eletr√¥nicos'}</div>
          ${product.discount>0?`<div class="absolute top-4 right-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-3 py-2 rounded-full text-sm font-bold shadow-lg">-${product.discount}%</div>`:''}
          <button class="absolute top-4 right-4 w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg hover:bg-red-50 transition-all duration-300 opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0" onclick="event.stopPropagation(); removeFavorite(${product.id})" title="Remover dos favoritos"><i class="fas fa-heart-broken text-red-500"></i></button>
        </div>
        <div class="p-6 flex flex-col flex-grow">
          <div class="flex items-center mb-4 h-6"><div class="flex text-yellow-400 mr-3">${Array.from({length:5},(_,i)=>`<i class=\"fas fa-star text-sm ${i<Math.floor(product.rating)?'text-yellow-400':'text-gray-300'}\"></i>`).join('')}</div><span class="text-sm text-gray-600 font-medium">(${product.rating})</span></div>
          <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2 h-14 flex items-center justify-center">${product.name}</h3>
          <p class="text-sm text-gray-500 mb-3 font-medium h-6 flex items-center justify-center">${product.brand||''}</p>
          <div class="mb-6 h-16 flex flex-col justify-center"><div class="flex items-center space-x-3 justify-center"><span class="text-3xl font-bold text-gray-900">R$ ${Number(product.price).toFixed(2).replace('.', ',')}</span>${product.discount>0&&product.originalPrice>product.price?`<span class="text-lg text-gray-500 line-through">R$ ${Number(product.originalPrice).toFixed(2).replace('.', ',')}</span>`:''}</div></div>
          <div class="flex gap-3 mt-auto"><button class="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold py-3 px-4 rounded-xl" onclick="event.stopPropagation(); guardedBuy(${product.id})"><i class="fas fa-bolt mr-2"></i>Comprar</button><button class="flex-1 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-800 font-bold py-3 px-4 rounded-xl" onclick="event.stopPropagation(); removeFavorite(${product.id})"><i class="fas fa-trash mr-2"></i>Remover</button></div>
        </div>
      </div>`; }
    function renderFavorites(){ const grid=document.getElementById('favorites-grid'); const empty=document.getElementById('favorites-empty'); const ids=readFavoritesIds(); if(!ids||ids.length===0){ grid.innerHTML=''; empty.classList.remove('hidden'); return; } const products=ids.map(id=>resolveProductById(id)).filter(Boolean); empty.classList.add('hidden'); grid.innerHTML=products.map(p=>renderCard(p)).join(''); }
    function removeFavorite(id){ const u=getCurrentUser(); const key=(u&&u.id)?('e2e_favorites_'+u.id):'e2e_favorites_guest'; let favs=[]; try{ favs=JSON.parse(localStorage.getItem(key)||'[]'); }catch{} favs=favs.filter(x=>String(x)!==String(id)); localStorage.setItem(key, JSON.stringify(favs)); try{ let global=JSON.parse(localStorage.getItem('e2e_favorites')||'[]'); global=global.filter(x=>String(x)!==String(id)); localStorage.setItem('e2e_favorites', JSON.stringify(global)); }catch{} if(typeof showFavoriteFeedback==='function') showFavoriteFeedback('‚ù§ Removido dos favoritos'); renderFavorites(); try{ window.dispatchEvent(new CustomEvent('favoritesUpdated')); }catch{} }
    function openProductDetail(id){ try{ localStorage.setItem('last_product_id', String(id)); }catch{} window.location.href=`product-detail.html?id=${id}`; }
    // Integra√ß√£o com API - Mostrar no Network
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('üöÄ Favorites.html carregada - Iniciando integra√ß√£o com API...');
        
        // Fazer chamada √† API para mostrar no network
        try {
            console.log('üîç Verificando disponibilidade da API...');
            console.log('üì° window.productsAPI:', window.productsAPI);
            
            if (window.productsAPI && typeof window.productsAPI.getProducts === 'function') {
                console.log('üåê Fazendo chamada √† API para mostrar no network...');
                const apiData = await window.productsAPI.getProducts({ page: 1, pageSize: 30 });
                console.log('‚úÖ API chamada realizada! Produtos no network:', apiData.products?.length || 0);
            } else {
                console.log('‚ö†Ô∏è ProductsAPI n√£o dispon√≠vel, tentando chamada direta...');
                
                // Tentar chamada direta para garantir que apare√ßa no network
                try {
                    const response = await fetch('https://catalogo-products.pages.dev/api/products?page=1&pageSize=30');
                    if (response.ok) {
                        const data = await response.json();
                        console.log('‚úÖ Chamada direta realizada! Produtos no network:', data.products?.length || 0);
                    }
                } catch (directError) {
                    console.log('‚ö†Ô∏è Erro na chamada direta:', directError.message);
                }
            }
        } catch (apiError) {
            console.log('‚ö†Ô∏è API n√£o dispon√≠vel, continuando com produtos locais:', apiError.message);
        }
        
        renderFavorites();
    });

    // Modal padronizado (igual ao detalhe) e compra protegida
    // Usar modal padronizado global se existir
    function showLoginRequiredModal(){ if (typeof window.showLoginRequiredModal === 'function') { window.showLoginRequiredModal(); } }

    function guardedBuy(productId) {
      var user = null;
      try { user = JSON.parse(localStorage.getItem('e2e_current_user')||'null'); } catch {}
      if (!user || !user.id) { showLoginRequiredModal(); return; }
      if (typeof buyNow === 'function') { buyNow(productId); return; }
      window.location.href = 'checkout.html';
    }
  </script>
</body>
  <script src="assets/js/mobile-ui.js"></script>
</html>
